<?xml version="1.0" encoding="UTF-8"?>
<project xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:noNamespaceSchemaLocation="../../src/resources/com/codeminders/hamake/syntax/hamakefile.xsd"
 name="cluster books">

  <property name="lib" value="/lib/" />
  <property name="cosine.distance" value="0.02" />

  <fileset id="input" path="/data/" mask="*.pdf" />
  <file id="output" path="/result.txt" />

  <foreach name="ExtractText">
    <input>
      <include idref="input" />
    </input>
    <output>
      <file id="plainText" path="/plainText/${foreach:filename}" />
    </output>
    <mapreduce jar="${lib}/hadoopJobs.job" main="com.example.TextExtractor">
      <parameter>
        <literal value="${foreach:path}" />
      </parameter>
      <parameter>
        <reference idref="plainText" />
      </parameter>
    </mapreduce>
  </foreach>

  <foreach name="Tokenize">
    <input>
      <file id="plainText" path="/plainText" />
    </input>
    <output>
      <file id="tokens" path="/tokens/${foreach:filename}" />
      <file id="vacabulary" path="/vacabulary" />
    </output>
    <mapreduce jar="${lib}/hadoopJobs.job" main="com.example.Tokenizer">
      ...
    </mapreduce>
  </foreach>

  <fold name="CalculateTF">
    <input>
      <file id="vacabulary" path="/vacabulary" />
      <file id="tokens" path="/tokens" />
    </input>
    <output>
      <file id="TFVector" path="/TFVector" />
    </output>
    <mapreduce jar="${dist}/hadoopJobs.job" main="com.example.CalculateTF">
      ...
    </mapreduce>
  </fold>

  <foreach name="RunCanopyClusteringAlgorithm">
    <input>
      <file id="TFVector" path="/TFVector" />
    </input>
    <output>
      <include idref="clustersList" path="/clusters"/>
    </output>
    <mapreduce jar="${lib}/hadoopJobs.job" main="com.example.Canopy">
      ...
    </mapreduce>
  </foreach>
  
  <foreach name="OutputResult">
    <input>
      <file id="clustersList" path="/clusters" />
    </input>
    <output>
      <include idref="output" />
    </output>
    <mapreduce jar="${lib}/hadoopJobs.job" main="com.example.OutputSimilarBooks">
      ...
    </mapreduce>
  </foreach>
</project>
