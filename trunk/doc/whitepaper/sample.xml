<?xml version="1.0" encoding="UTF-8"?>
<project name="cluster books">

  <property name="lib" value="./lib/" />
  <property name="cosine.distance" value="0.02" />

  <fileset id="input" path="/data/" mask="*.pdf" />
  <file id="output" path="./result.txt" />
  <file id="stopwords" path="./stopwords.txt" />
  <file id="tmp" path="/tmp/" />

  <foreach name="extractPlainText">
    <input>
      <include idref="input" />
    </input>
    <output>
      <file id="bookInPlainTextFormat" path="${tmp}/plainText/${foreach:filename}" />
    </output>
    <mapreduce jar="${lib}/hadoopJobs.job" main="com.fb2pdf.hadoop.cluster.ConvertFb2Text">
      <parameter>
        <literal value="${foreach:path}" />
      </parameter>
      <parameter>
        <reference idref="bookInPlainTextFormat" />
      </parameter>
    </mapreduce>
  </foreach>

  <foreach name="KeywordsExtractor">
    <input>
      <file id="bookInPlainTextFormat" path="${tmp}/plainText" />
    </input>
    <output>
      <file id="bookKeywords" path="${tmp}/keywords/${foreach:filename}" />
      <file id="vacabulary" path="${tmp}/vacabulary" />
    </output>
    <mapreduce jar="${lib}/hadoopJobs.job" main="com.fb2pdf.hadoop.cluster.KeywordsExtractor">
      ...
    </mapreduce>
  </foreach>

  <foreach name="ExcludeStopword">
    <dependencies>
      <include idref="KeywordsExtractor" />
    </dependencies>
    <input>
      <fileset id="vacabulary" path="${tmp}/vacabulary" />
    </input>
    <output>
      <file id="vacabularyWithoutStopwords" path="${tmp}/vacabularyWOStopWords/${foreach:filename}" />
    </output>
    <mapreduce jar="${dist}/hadoopJobs.job" main="com.fb2pdf.hadoop.cluster.StopwordsExcluder">
      ...
    </mapreduce>
  </foreach>

  <fold name="FeatureVectorsFromDirectory">
    <input>
      <file id="vacabularyWithoutStopwords" path="${tmp}/vacabularyWOStopWords" />
      <file id="keywords" path="${tmp}/keywords" />
    </input>
    <output>
      <file id="featureVectorsFile" path="${tmp}/featureVectors" />
    </output>
    <mapreduce jar="${dist}/hadoopJobs.job" main="com.fb2pdf.hadoop.cluster.FeatureVectorsFromDirectory">
      ...
    </mapreduce>
  </fold>

  <foreach name="OutputResults">
    <input>
      <file id="featureVectors" path="${tmp}/featureVectors" />
    </input>
    <output>
      <include idref="output" />
    </output>
    <mapreduce jar="${lib}/hadoopJobs.job" main="com.fb2pdf.hadoop.cluster.OutputClusterResults">
      ...
    </mapreduce>
  </foreach>
</project>
