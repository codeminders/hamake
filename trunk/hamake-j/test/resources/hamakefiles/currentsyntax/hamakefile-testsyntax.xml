<project name="test-syntax" default="foreach1">

	<property name="dfsroot" value="/root" />
	<property name="basedir" value="/base" />
	
	<file id="somedir" path="${basedir}/somedir"/>
	<fileset id="foreach1Output" path="${dfsroot}/referrers" mask="*.log" />

	<foreach name="foreach1">
		<dependencies>
			<file path="${basedir}/somefile.txt"/>
		</dependencies>
		<description>first foreach</description>
		<input>
			<include idref="foreach1Output"/>
		</input>
		<output>
			<file id="domainReferrersTotals" path="${dfsroot}/related/domain_referrers_totals/$#.txt" generation="1" />
		</output>
		<mapreduce jar="${basedir}/datamining.jar" main="us.imageshack.datamining.Access2Referrers">
			<parameter>
				<literal value="$_" />
			</parameter>
			<parameter>
				<reference idref="domainReferrersTotals" />
			</parameter>
		</mapreduce>
	</foreach>
	<foreach name="foreach2">
		<description>second foreach</description>
		<input>
			<fileset path="${dfsroot}/related/domain_referrers_totals" generation="2" />
		</input>
		<output expiration="2d">
			<set id="out">
				<file path="${dfsroot}/related/image_domains1/$@" />
				<file path="${dfsroot}/related/image_domains2/$@" />
			</set>
		</output>
		<exec binary="cat">
			<parameter>
				<literal value="$_" />
			</parameter>
			<parameter>
				<literal value=">" />
			</parameter>
			<parameter> 
				<reference idref="out" />
			</parameter>
		</exec>
	</foreach>
	<foreach name="foreach3" disabled="true">
		<description>second foreach</description>
		<input>
			<fileset path="${dfsroot}/related/domain_referrers_totals" generation="2" />
		</input>
		<output expiration="2d">
			<set id="out">
				<file path="${dfsroot}/related/image_domains1" />
				<file path="${dfsroot}/related/image_domains2" />
			</set>
		</output>
		<exec binary="cat">
			<parameter>
				<literal value="$_" />
			</parameter>
			<parameter>
				<literal value=">" />
			</parameter>
			<parameter>
				<reference idref="out" />
			</parameter>
		</exec>
	</foreach>
	<fold name="reduce">
		<dependencies>
			<file path="${basedir}/somefile.txt"/>
		</dependencies>
		<description>reducer</description>
		<input>
			<set>
				<file id="infile" path="${dfsroot}/image_domains" generation="1"/>
				<fileset id="infileset" path="${dfsroot}/rev" mask="*.file"/>
			</set>
		</input>
		<output expiration="15h">
			<set>
				<file id="outPornStat" path="${dfsroot}/related/porn_stats.tmp"/>
				<file id="outRelated" path="${dfsroot}/related/" mask="*.file" variant="mask"/>
			</set>
		</output>
		<pig script="median.pig">
			<parameter>
				<literal value="$_" />
			</parameter>
			<jobconf name="jcname" value="jcvalue" />
			<parameter>
				<reference idref="outRelated" />
			</parameter>
		</pig>
	</fold>
</project>